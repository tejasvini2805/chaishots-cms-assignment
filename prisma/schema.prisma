generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ProgramStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum LessonStatus {
  DRAFT
  SCHEDULED
  PUBLISHED
  ARCHIVED
}

enum ContentType {
  VIDEO
  ARTICLE
}

model Program {
  id                 String        @id @default(uuid())
  title              String
  description        String?
  languagePrimary    String
  languagesAvailable String[]
  status             ProgramStatus @default(DRAFT)
  publishedAt        DateTime?
  createdAt          DateTime      @default(now())
  updatedAt          DateTime      @updatedAt

  // JSON assets: posters per language + variant
  posterAssets       Json

  terms              Term[]
  topics             ProgramTopic[]
}

model Topic {
  id       String          @id @default(uuid())
  name     String          @unique
  programs ProgramTopic[]
}

model ProgramTopic {
  programId String
  topicId   String

  program Program @relation(fields: [programId], references: [id])
  topic   Topic   @relation(fields: [topicId], references: [id])

  @@id([programId, topicId])
}

model Term {
  id         String   @id @default(uuid())
  title      String?
  order      Int
  programId  String
  createdAt DateTime @default(now())

  program Program @relation(fields: [programId], references: [id])
  lessons Lesson[]

  @@unique([programId, order])
}

model Lesson {
  id                       String        @id @default(uuid())
  title                    String
  order                    Int
  status                   LessonStatus @default(DRAFT)
  contentType              ContentType
  durationMs               Int?
  isPaid                   Boolean       @default(false)

  contentLanguagePrimary   String
  contentLanguagesAvailable String[]
  contentUrlsByLanguage    Json

  subtitleLanguages        String[]
  subtitleUrlsByLanguage   Json?

  // JSON assets: thumbnails per language + variant
  thumbnailAssets          Json

  publishAt                DateTime?
  publishedAt              DateTime?
  createdAt                DateTime      @default(now())
  updatedAt                DateTime      @updatedAt

  termId String
  term   Term @relation(fields: [termId], references: [id])

  @@unique([termId, order])
  @@index([status, publishAt])
}
